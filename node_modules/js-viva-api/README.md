
# TODO

    - [X] README: Listings
    - [X] README: Autocomplete
    - [X] README: Geo Listings
    - [X] README: Geo Cluster Search
    - [X] README: Property Detail
    - [ ] README: Get Sublocations
    - [ ] README: Send lead
    - [ ] Implement unit tests
      - [X] Listings
      - [X] Geo Listings
      - [X] Geo Cluster Search
      - [X] Autocomplete
      - [ ] Property Detail
      - [ ] Property Contact Detail
      - [ ] Send Lead
      - [ ] Get Sublocations
    - [X] Make the tests pass in node.js
    - [ ] Make the tests pass in all supported browsers


# Notes

# What does the API do?

Currently the API has endpoints for the following functionality:

  * Fetch listings given:
     * geo queries (lat + long) and some parameters
     * a locationID and some parameters
  * Autocomplete locations
  * Get the details for a specific property
  * Get the contact information for a specific property
  * Fetch sublocations given a locationID (e.g. zones in Bogot√°)
  * Fetch clusters of locations given geo queries
  * POST leads

Soon we'll be adding more functionality:

  * Fetch new developments as well as used properties
  * ??

## Installation

#### Simplest

The simplest method to install this library is just dropping the built library 
into the page with a script tag. This will make the `VivaAPI` object available 
globally.

```html
<script src="//.../js-viva-api.js"></script>
```

#### Browserify

You can also install it via npm and use it via browserify. Since this will not 
(yet) be published to npm, you will have to give npm the git url.

```
npm install VivaReal/js-viva-api
```

You can then require it in your code like any other npm package

```javascript
var VivaAPI = require('viva-api');
```

#### require.js

The library will also be written with an AMD-compatible wrapper so that it will
able to be used directly in require.js projects.

#### Node.js

The instructions for using this in node are the same as using it in a browserify 
project.


## Initialization

Once you have the library included in your environment, you can need to initialize
the wrapper with a few pieces of information.

```javascript
var api = new VivaAPI({
  baseUrl: "http://api.vivareal.com/api/1.0",        // Should we default to this?
  apiKey: "183d98b9-fc81-4ef1-b841-7432c610b36e",
  token: "...",                                      // optional
  portal: "VR_BR"
});
```

# Usage Summary

```javascript
// Perform a search given a location id
api.listings(listingParameters, filters, callback);

// Perform a search for listings or locaitons given latitude and longitude information
api.geoSearch(geoListingParameters, filters, callback);

// Navigate the hierarchy of locations
api.sublocations(locationID, callback);

// Autocomplete a location
api.autocomplete('input', callback);

// Get the full info for a specific property
api.property('property_id', callback);

// Get the contact info for a specific property
api.contact('property_id', callback);

// Send a lead for a particular property
api.sendLead(leadInfo, callback);
```

# Filters

The listings and geoListings methods share a common filters parameter. We can define
parameters that can be used to narrow down either search. They are defined in a plain
javascript object that looks like this:

```javascript
var filters = {
  area: [ null, 100 ],
  bedrooms: [ 1, 3 ],
  order: 'PRICE_ASCENDING',
  type: 'APARTMENT'
};
```

I will try to list all of the parameter options here.

**Default parameters**

If certain parameters are not added to the request, they will default to:

```
hasPhoto: true,
page: 1,
```

**Range parameters**

There are 5 parameters that are defined via a range.

* `area` - The area in square meters
* `price` - The price in the given currency
* `bedrooms` - The number of bedrooms
* `bathrooms` - The number of bathrooms
* `parking` - The number of parking spaces

To define a range, use an array with two values. If one of the ranges is
open-ended (e.g. 2 or more bedrooms) pass a `null`
value for the open end of the range. All ranges are inclusive.

Examples:

```
// 2 - 3 bedrooms
bedrooms: [ 2, 3 ]

// Up to 2 bedrooms
bedrooms: [ null, 2 ]

// at least 3 bedrooms
bedrooms: [ 3, null ]
```

**Parameters with string values**

There are several parameters that need to be defined by one of a specific set of strings.

`order` - Define the order for the results

* `null` - The natural ordering as determined by the service
* `"PRICE_ASCENDING"` - Order by price starting with the lowest
* `"PRICE_DESCENDING"` - Order by price starting with the highest
* `"BATHROOMS"` - Order by number of bathrooms starting with the the lowest
* `"BEDROOMS"` - Order by number of bedrooms starting with the lowest

`type` - Define the type of properties we'd like to see

* `"APARTMENT"`
* `"???"`
* `"HOUSE"`
* `"FARM"`
* `"CONDO"`
* `"FLAT"`
* `"LOT"`
* `"???"`
* `"???"`
* `"???"`
* `"OFFICE"`
* `"COMMERCIAL_FARM"`
* `"WAREHOUSE"`
* `"???"`
* `"???"`
* `"???"`

`business` - Define the type of property transactions we want

* `"SALE"` - Used properties for sale
* `"RENT"` - Properties for rent
* `"PROJECTS"` - **Not yet available**

**Other parameters**

* `numResults` - The number of results requested from the API
* `page` - The page of results to show
* `hasPhoto` - Filter out results that don't have a photo associated
* `currency` - This should automatically be set based on the portal

**Parameters that are not understood**

There are a few parameters defined in the API that I do not yet understand:

* `accountID` - to be used in the future to request searches from a particular publisher
* `url`
* `queryAllLocations` - Oscar is also confused as to what this could possibly mean
* `listingUse` - Residential or commerical, but I don't see the use

# Listings

### Example Usage:

```javascript
// Define the parameters for your search in a plain javascript object
var parameters = {
  locations: '/sp/sao-paulo', 
  business: 'RENT'
};

// Define the filters on the search
var filters = {
  bedrooms: [ 2, 2 ],
  price: [ 1000000, 2000000 ]
};

// Get the appropriate url for the request for the given parameters.
api.listings(parameters, filters);

// Have the library fetch the results for you. You can trigger the 
// request by passing in a node-style callback as a third argument.
api.listings(parameters, filters, function(err, data) {
 /* ... */
});
```

### Parameters

There is one parameter that is required to get the listings: `locations`

`locations` - Can either be a string or an array of strings. Each string must be a location
id. Location ids look like: `"/sp/sao-paulo"`

Currently there is a restriction that if you pass multiple locations that they must all be
neighborhoods for the same zone or city if there are no zones for that city. If you pass
multiple locations that do not meet this criteria an error will fire.

Example:
```
locations: '/sp/sao-paulo/zona-sul/morumbi'

locations: [
    '/sp/sao-paulo/zona-sul/morumbi',
    '/sp/sao-paulo/zona-sul/moema',
    '/sp/sao-paulo/zona-sul/campo-belo',
    '/sp/sao-paulo/zona-sul/vila-mariana'
]
```

# Geo Search

Return either listings of properties or locations in a specific geographic region.

### Example Usage

```javascript
var parameters = {
  latitude: 4.672606,
  longitude: -74.057666,
  radius: 1000,
  level: 'NEIGHBORHOOD'
};

var listingsUrl = api.geoSearch(parameters, filters, function(err, data) {
  /* ... */    
});
```

There are four parameters required for the search:

* `latitude`
* `longitude`
* `radius` - in meters
* `level` - one of `"COUNTRY"`, `"STATE"`,`"CITY"`,`"ZONE"`,`"NEIGHBORHOOD"`, `"LISTINGS"`

N.B. `"LISTINGS"` will work a little differently from the others, but we'll work on 
ironing out those differences in the future.

# Autocomplete locations

```javascript
api.autocomplete('input');
// => Url

api.autocomplete('input', function(err, data) { /* ... */ });
```

# Specific Property Info

```javascript
api.property('property_id'); // => Url

api.property('property_id', function(err, data) { /* ... */ });
```

# Specific Property Contact Info

```javascript
api.contact('property_id'); // => Url

api.contact('property_id', function(err, data) { /* ... */ });
```

# Fetch sublocations given a locationID

```javascript
api.sublocations('/sp/sao-paulo'); // => Url

// Return the sublocations of a given location id
api.sublocations('/sp/sao-paulo', function(err, data) { /* ... */ });
```

# Post leads

```javascript
api.sendLead({ /* lead info */ }, function(err, data) {
  // data will just hold a success message if the POST was successful 
});

TODO: Need to document the data required
```






